export const metadata = {
    title: 'Upgrade to LdapRecord v4',
    description: 'Upgrading from LdapRecord v3',
}

# Upgrading to Version 4

We strive to record all potential breaking changes. However, as some of
these changes occur in lesser-known areas of the library, only a
fraction of them might have an impact on your application.

If you encounter any changes not documented here that have affected you,
please create a bug report on the [LdapRecord-Docs repository](https://github.com/DirectoryTree/LdapRecord-Docs/issues/new)
so that we can address the issue promptly.

## High Impact Changes

### Updating Dependencies

#### Composer Dependencies

You should update the following dependency in your application's `composer.json` file:

```json
"directorytree/ldaprecord": "^4.0"
```

### SSL/TLS Configuration Options Renamed

The SSL and TLS configuration options have been renamed to more accurately reflect their purpose:

| Old Configuration Option | New Configuration Option |
|--------------------------|--------------------------|
| `use_ssl`                | `use_tls`                |
| `use_tls`                | `use_starttls`           |

### LdapInterface Method Names Updated

Several methods in the `LdapRecord\LdapInterface` have been renamed to align with the configuration changes:

| Old Method              | New Method                |
|-------------------------|---------------------------|
| `setSSL()`              | `setTLS()`                |
| `setTLS()`              | `setStartTLS()`           |
| `isUsingSSL()`          | `isUsingTLS()`            |
| `isUsingTLS()`          | `isUsingStartTLS()`       |

### Parameter Names Standardized

Throughout the LdapRecord codebase, parameter names have been adjusted to better align with LDAP terminology:

| Old Parameter Name | New Parameter Name |
|--------------------|--------------------|
| `$fields`          | `$attributes`      |
| `$columns`         | `$selects`         |

If you have extended any LdapRecord classes or implemented interfaces that use these parameters, you will need to update your method signatures accordingly.

## Medium Impact Changes

### Model Builder and Query Builder Separation

The `Model\Builder` and `Query\Builder` classes are now completely separate classes without inheritance. This change provides better separation of concerns and clearer APIs.

If you have extended either of these classes or relied on their inheritance relationship, you may need to adjust your code accordingly.

Most applications should not be affected by this change, as the public APIs of both classes remain unchanged, and the `Model\Builder` proxies various methods to the underlying `Query\Builder` instance.

### EscapedValue Class Moved

The `LdapRecord\Models\Attributes\EscapedValue` class has been moved to `LdapRecord\Query\EscapedValue`.

### Query Chaining Behavior Updated

The `where` and `orWhere` query chaining behavior has been updated to match Eloquent's behavior more closely. This provides more predictable and intuitive query building.

If you have complex query chains that rely on the previous behavior, you may need to review and adjust them.

### LdapInterface Protocol and Port Constants Renamed

Several constants have been renamed on `LdapInterface` for consistency with the SSL/TLS configuration option changes:

| Old Constant                  | New Constant                  |
|-------------------------------|-------------------------------|
| `LdapInterface::PROTOCOL_SSL` | `LdapInterface::PROTOCOL_TLS` |
| `LdapInterface::PORT_SSL`     | `LdapInterface::PORT_TLS`     |

## Low Impact Changes

### Helper Class Renamed

The `LdapRecord\Support\Helpers` class has been renamed to `Value` for better clarity.

### Diagnostic Code Method Renamed

The `extractDiagnosticCode` method on `LdapRecord\Ldap` class has been renamed to `getDiagnosticCode`.

### Additional Method Improvements

Several methods have received return type improvements and better naming conventions. These changes are primarily internal and should not affect most applications, but may require updates if you have extended LdapRecord classes extensively.

## Testing Your Upgrade

After upgrading to LdapRecord v4, we recommend:

1. **Update your configuration** - Ensure all SSL/TLS configuration options use the new names
2. **Review custom extensions** - If you have extended LdapRecord classes, verify method signatures and parameter names
3. **Test connections** - Verify that your LDAP connections work correctly with the new SSL/TLS configuration
4. **Run your test suite** - Ensure all existing functionality continues to work as expected

## Getting Help

If you encounter issues during the upgrade process or need assistance with any of these changes, please:

1. Check the [LdapRecord documentation](/docs/core/v4) for updated examples
2. Search existing [GitHub issues](https://github.com/DirectoryTree/LdapRecord/issues)
3. Create a new issue if you discover problems not covered in this guide

We're committed to making the upgrade process as smooth as possible and appreciate your feedback on any challenges you encounter.
